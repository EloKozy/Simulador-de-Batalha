import random

#HeranÃ§a:
class RPG:
    def __init__(self, name, classes, health, strength, intelligence, dexterity):
        self.name = name
        self.classes = classes
        self.health = health
        self.max_health = health
        self.strength = strength
        self.intelligence = intelligence
        self.dexterity = dexterity

    def level(self):
        return 5
    def is_alive(self):
        return self.health > 0
    def take_damage(self, amount, defense=0):
        damage_taken = max(1, amount - defense)
        self.health = max(0, self.health - damage_taken)
        print(f"ğŸ’¥ {self.name} recebeu {damage_taken} de dano (defendeu {defense})! HP restante: {self.health}/{self.max_health}")
        if not self.is_alive():
            print(f"â˜ ï¸ {self.name} foi derrotado!")
    def defend_value(self):
        return int(self.dexterity / 2) + random.randint(1, 4)
    def attack_value(self):
        return self.strength + random.randint(0, 3)
    def __str__(self):
        status = "ğŸ©¸Vivo" if self.is_alive() else "â˜ ï¸ Derrotado"
        return f"{self.name} ({self.classes}) - LVL {self.level()} | HP: {self.health}/{self.max_health} | {status}"

#SobreposiÃ§Ã£o de FunÃ§Ãµes:
class Warrior(RPG):
    def __init__(self, name, classes, health, strength, intelligence, dexterity, kills):
        super().__init__(name, classes, health, strength, intelligence, dexterity)
        self.kill = kills
    def level(self):
        return self.kill + 1 + super().level()
    def attack_value(self):
        print(f"âš”ï¸ {self.name} ataca com sua espada!")
        return self.strength + random.randint(3, 6)
    def defend_value(self):
        return int(self.dexterity / 2) + random.randint(2, 5)

class Archer(RPG):
    def __init__(self, name, classes, health, strength, intelligence, dexterity, precision):
        super().__init__(name, classes, health, strength, intelligence, dexterity)
        self.precision = precision
    def level(self):
        return (self.precision // 2) + super().level()
    def attack_value(self):
        base = self.dexterity // 2 + random.randint(3, 7)
        if random.random() < 0.25:
            print(f"ğŸ¯ {self.name} acertou um TIRO CRÃTICO!")
            return base * 2
        print(f"ğŸ¹ {self.name} disparou uma flecha!")
        return base
    def defend_value(self):
        return int(self.dexterity / 3) + random.randint(1, 6)

class Healer(RPG):
    def __init__(self, name, classes, health, strength, intelligence, dexterity, assistence):
        super().__init__(name, classes, health, strength, intelligence, dexterity)
        self.assistence = assistence
    def level(self):
        return self.assistence + 1 + super().level()
    def attack_value(self):
        print(f"âœ¨ {self.name} lanÃ§a um feitiÃ§o ofensivo!")
        return self.intelligence // 3 + random.randint(1, 4)
    def defend_value(self):
        return int(self.dexterity / 3) + random.randint(1, 3)
    def heal(self, ally):
        if not self.is_alive():
            return
        heal_amount = self.intelligence + random.randint(3, 7)
        ally.health = min(ally.max_health, ally.health + heal_amount)
        print(f"ğŸ’– {self.name} curou {ally.name} em {heal_amount} HP! ({ally.health}/{ally.max_health})")
    
class Enemy(RPG):
    def __init__(self, name, enemy_type, health, strength, intelligence, dexterity, danger_level):
        super().__init__(name, enemy_type, health, strength, intelligence, dexterity)
        self.danger = int(danger_level)
    def level(self):
        return super().level() * 2 + self.danger
    def attack_value(self):
        return self.strength + random.randint(0, 3)
    def defend_value(self):
        return int(self.dexterity / 2) + random.randint(1, 3)   

class Goblin(Enemy):
    def __init__(self, name, rank="Comum"):
        base_health = 12 if rank == "Comum" else 18
        base_strength = 5 if rank == "Comum" else 7
        base_intelligence = 3
        base_dexterity = 7
        danger = 1 if rank == "Comum" else 3
        super().__init__(name, f"Goblin {rank}", base_health, base_strength, base_intelligence, base_dexterity, danger)
    def attack(self, target):
        base = self.strength + random.randint(0, 3)
        if random.random() < 0.15:
            base *= 2
            print(f"ğŸ’¢ {self.name} acertou um golpe CRÃTICO em {target.name}!")
        else:
            print(f"ğŸ—¡ï¸ {self.name} esfaqueou {target.name}!")
        defense = target.defend_value()
        target.take_damage(base, defense)

class Orc(Enemy):
    def __init__(self, name, berserk=False):
        base_health = 30 if not berserk else 35
        base_strength = 8 if not berserk else 10
        base_intelligence = 5
        base_dexterity = 6
        danger = 4 if not berserk else 6
        super().__init__(name, "Orc Guerreiro", base_health, base_strength, base_intelligence, base_dexterity, danger)
        self.berserk = berserk
    def attack_value(self):
        base = self.strength + random.randint(2, 5)
        if self.berserk:
            print(f"ğŸ”¥ {self.name} entrou em fÃºria!")
            base = int(base * 1.2)
        return base
    def defend_value(self):
        return int(self.dexterity / 2) + random.randint(1, 3)
        
class OrcKing(Enemy):
    def __init__(self, name, sovereign):
        super().__init__(name, "Rei Orc", 45, 11, 8, 6, 8)
        self.sovereign = sovereign
    def attack_value(self):
        print(f"ğŸ‘‘ {self.name} desferiu um golpe real!")
        return self.strength + random.randint(2, 6)
    def defend_value(self):
        return int(self.dexterity / 2) + random.randint(1, 4)
    def heal_self(self):
        if random.random() < 0.25:
            heal = 4
            self.health = min(self.max_health, self.health + heal)
            print(f"ğŸ’€ {self.name} rugiu e recuperou {heal} de HP! ({self.health}/{self.max_health})")

warrior = Warrior("Tharok", "Paladino", 30, 10, 8, 11, 9)
archer = Archer("Thalion", "Ranger", 24, 12, 10, 16, 20)
healer = Healer("Isolde", "ClÃ©rigo", 22, 9, 17, 9, 8)
goblin = Goblin("Grubnak", "LÃ­der")
orc = Orc("Grumash", berserk=True)
orcking = OrcKing("Zoghtar", 6)
#Array GenÃ©rico:
party = [warrior, archer, healer]
enemies = [goblin, orc, orcking]

#Polimorfismo:
print("=== STATUS INICIAL ===")
for c in party + enemies:
    print(c)
print("\n=== INÃCIO DA BATALHA ===")
while any(hero.is_alive() for hero in party) and any(enemy.is_alive() for enemy in enemies):
    print("\n--- Novo turno ---")
    random.shuffle(party)
    for hero in party:
        if hero.is_alive():
            alive_enemies = [e for e in enemies if e.is_alive()]
            if alive_enemies:
                target = random.choice(alive_enemies)
                if isinstance(hero, Healer) and random.random() < 0.5:
                    healer_targets = [h for h in party if h.is_alive() and h.health < h.max_health]
                    if healer_targets:
                        ally = random.choice(healer_targets)
                        hero.heal(ally)
                        continue
                damage = hero.attack_value()
                defense = target.defend_value()
                target.take_damage(damage, defense)

    random.shuffle(enemies)
    for enemy in enemies:
        if enemy.is_alive():
            alive_heroes = [h for h in party if h.is_alive()]
            if alive_heroes:
                target = random.choice(alive_heroes)
                if isinstance(enemy, Goblin):
                    enemy.attack(target)
                else:
                    damage = enemy.attack_value()
                    defense = target.defend_value()
                    target.take_damage(damage, defense)
                if isinstance(enemy, OrcKing):
                    enemy.heal_self()

print("\nğŸ† A batalha terminou!")
if any(hero.is_alive() for hero in party):
    print("Os herÃ³is venceram!")
else:
    print("Os inimigos triunfaram...")
